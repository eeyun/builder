digraph STATES {

  ranksep=0.2;

////////////////////////////////////////////////////////////////////////
// Group states
node[fontname="Courier", shape=oval];
Triggered;
Created;
Queued;
Dispatching;
Complete;
FailureCleanup;
Failed;
Cancelling;
Cancelled;

Triggered -> Created;
Triggered -> Failed;
Triggered -> Cancelled;

Created -> Queued;
Created -> Failed;
Created -> Cancelled;

Queued -> Dispatching;
Queued -> Cancelled;

Dispatching -> Complete;
Dispatching -> FailureCleanup;
Dispatching -> Cancelling;

FailureCleanup -> Failed;

Cancelling -> Cancelled;

////////////////////////////////////////////////////////////////////////
// Job states
node[fontname="Courier", shape=box];
Pending;
WaitingOnDependency;
WaitingOnWorker;
Working;
JobComplete;
JobFailed;
DependencyFailed;
CancelPending;
CancelComplete;

Pending -> WaitingOnDependency; 
Pending -> CancelComplete;

WaitingOnDependency -> WaitingOnWorker;
WaitingOnDependency -> DependencyFailed;
WaitingOnDependency -> CancelComplete;

WaitingOnWorker -> Working;
WaitingOnWorker -> CancelComplete;
WaitingOnWorker -> DependencyFailed;

Working -> JobComplete; // Complete
Working -> JobFailed; // FatalError
Working -> WaitingOnWorker; // NonFatalError
Working -> CancelPending;

CancelPending -> CancelComplete;

{rank=same; JobFailed JobComplete DependencyFailed CancelComplete}

// Cross FSM relationships
{rank=same; Created Pending}
{rank=same; Dispatching WaitingOnWorker}

{rank=same; Cancelling FailureCleanup}

{rank=same; Complete Failed Cancelled }

{rank=same; Complete JobComplete}
}



